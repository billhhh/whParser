package com.DBOperation;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;

import com.mysql.jdbc.Statement;

public class DBOperation {
	
	Connection conn;
	String dbname = "jdbc:mysql://localhost:3306/rsdb";
	String user = "root";
	String password = "root";
	String sql;
	Statement stmt;
	
	//1、就是得到数据库连接
	public DBOperation(){
		try{
			Class.forName("com.mysql.jdbc.Driver");
			this.conn = DriverManager.getConnection(dbname,user,password);
		}catch(SQLException e){
			System.out.println("数据库连接失败");
		}catch(ClassNotFoundException e){
			e.printStackTrace();
		}
	}
	
	
	
	
	/* 
	 * 2、将商品URL的ArrayList插入数据库
	 * */
	public void insertUrlList(String tablename,ArrayList<String> arrayList)throws SQLException{
		
		for(String urlStr : arrayList){
			/*ignore在某些主键primary约束中避免错误的重复插入*/
			sql = "insert ignore into "+tablename+"(url) values(\"" + urlStr + "\");";
//			System.out.println(sql);
			stmt = (Statement)conn.createStatement();
			stmt.executeUpdate(sql);
		}
	}
	
	
	
	/* @param:null
	 * 3、返回数据库记录条数*/
	public int getRecordNum(){
		int recordNum = 0;
		sql = "select count(*) from dangdangUrlCache;";
		try{
			 stmt = (Statement)conn.createStatement();
			 ResultSet rs= stmt.executeQuery(sql);
			 if(rs.next()){
				 recordNum = rs.getInt(1);
			 }
			 }catch(Exception e){
				 System.out.println(e.getMessage());
			 }
		return recordNum;
	}
	
	
	//4、返回行数
	public ArrayList<String> getRows(int pageSize,int first){
		ArrayList<String> rows = new ArrayList<String>();
		sql = "select * from dangdangUrlCache limit " + first + "," + pageSize + ";" ;
		try{
			stmt = (Statement)conn.createStatement();
			ResultSet rs = stmt.executeQuery(sql);
			while(rs.next()){
				rows.add(rs.getString(1));
			}
		}catch(Exception e){
			System.out.println(e.getMessage());
		}
		return rows;
	}
	
	
	
}
